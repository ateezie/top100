(function(){"use strict";function c(e){console.warn&&console.warn(e)}function d(e){try{return JSON.parse(atob(e.split(".")[1].replace(/-/g,"+").replace(/_/g,"/")))}catch(t){return c("Failed to decode JWT: "+t.message),null}}function l(){var e=i("tncms-user");if(!e)return null;var t=d(e);return t&&t.app||null}function L(e){window.location.replace?window.location.replace(e):window.location.assign?window.location.assign(e):window.location.href=e}function o(){return document.cookie.indexOf("tncms-user")!==-1||document.cookie.indexOf("tncms-authtoken")!==-1}function p(){var e=l();return e!==null?e.user&&e.user.adm:o()&&i("tncms-isadmin")==!0}function m(){var e=l();return e&&e.user&&e.user.scr?e.user.scr:i("tncms-screenname")}function g(e){var t=window.location.href.split("#"),n=t[0],a=t[1];if(n.indexOf("_dc="+e)>-1){c("Attempt to auto-fix logged/anonymous view failed");return}n.indexOf("?")>-1?n+="&_dc="+e:n+="?_dc="+e,a&&(n+="#"+a),L(n)}function i(e){for(var t=e+"=",n=document.cookie.split(";"),a=0;a<n.length;a++){for(var r=n[a];r.charAt(0)==" ";)r=r.substring(1,r.length);if(r.indexOf(t)==0)return decodeURIComponent(r.substring(t.length,r.length).replace(/\+/g," "))}return null}var I=function(){var e=288e5,t="TNCMSUserHeartbeatTime",n="TNCMSUserHeartbeatLock",a="TNCMSUserLogout",r;function f(){var u=Date.now(),w=localStorage.getItem(t),h=localStorage.getItem(n),b=m();if(h){if(h>=u-5*60*1e3)return;localStorage.removeItem(n)}if(!w){localStorage.setItem(t,u);return}if(!(w>=u-e)){if(!o()){clearInterval(r);return}localStorage.setItem(n,u);var s=new XMLHttpRequest;s.open("POST","/tncms/auth/heartbeat"),s.setRequestHeader("X-Requested-With","XMLHttpRequest"),s.addEventListener("load",function(){if(s.status>=400){console.error("Heartbeat error, will try again later");return}var N=JSON.parse(s.responseText);if(!N.logged_in){c("User logged out by heartbeat");var S=new Event(a);S.user={screen_name:b},document.dispatchEvent(S),clearInterval(r)}localStorage.setItem(t,u),localStorage.removeItem(n)}),s.send()}}return function(){!o()||!window.localStorage||(f(),r=setInterval(f,e),document.addEventListener("visibilitychange",f))}}();window.TNCMS||(window.TNCMS={}),window.TNCMS.User={getScreenName:m,getFirstName:function(){return this.getClaim("user","fn")},getLastName:function(){return this.getClaim("user","ln")},getEmail:function(){return this.getClaim("user","em")},getCreateTimestamp:function(){return this.getClaim("user","crt")},getAvatarURL:function(){var e=l();return e&&e.user&&e.user.ava?e.user.ava:i("tncms-avatarurl")},hasPersistentSession:o,hasWebauthnCredential:function(){return!!i("tncms-webauthn-available")},hasFullAccess:function(){var e=i("tncms-user");if(!e)return!1;var t=d(e);return t?!t.ro:!1},isLoggedIn:o,isAdmin:p,getClaim:function(e,t){var n=l();return n!==null&&n[e]!==void 0&&n[e][t]!==void 0?n[e][t]:null},validateAnonymousView:function(){o()&&g("logged_in")},validateLoggedInView:function(){o()||g("anonymous")},restorePersistentSession:function(){}};function v(){I()}document.readyState==="loading"?v():document.addEventListener("DOMContentLoaded",v)})();
//# sourceMappingURL=user.js.map
