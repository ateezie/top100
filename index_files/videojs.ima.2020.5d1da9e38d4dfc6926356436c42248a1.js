(function(d,n){typeof exports=="object"&&typeof module<"u"?module.exports=n(require("video.js")):typeof define=="function"&&define.amd?define(["video.js"],n):d.videojsIma=n(d.videojs)})(this,function(d){"use strict";d=d&&d.hasOwnProperty("default")?d.default:d;var n=function(e,r,a){this.vjsPlayer=e,this.controller=a,this.contentTrackingTimer=null,this.contentComplete=!1,this.updateTimeIntervalHandle=null,this.updateTimeInterval=1e3,this.seekCheckIntervalHandle=null,this.seekCheckInterval=1e3,this.resizeCheckIntervalHandle=null,this.resizeCheckInterval=250,this.seekThreshold=100,this.contentEndedListeners=[],this.contentSource="",this.contentSourceType="",this.contentPlayheadTracker={currentTime:0,previousTime:0,seeking:!1,duration:0},this.vjsPlayerDimensions={width:this.getPlayerWidth(),height:this.getPlayerHeight()},this.vjsControls=this.vjsPlayer.getChild("controlBar"),this.h5Player=null,this.vjsPlayer.one("play",this.setUpPlayerIntervals.bind(this)),this.boundContentEndedListener=this.localContentEndedListener.bind(this),this.vjsPlayer.on("contentended",this.boundContentEndedListener),this.vjsPlayer.on("dispose",this.playerDisposedListener.bind(this)),this.vjsPlayer.on("readyforpreroll",this.onReadyForPreroll.bind(this)),this.vjsPlayer.ready(this.onPlayerReady.bind(this)),this.controller.getSettings().requestMode==="onPlay"&&this.vjsPlayer.one("play",this.controller.requestAds.bind(this.controller)),this.vjsPlayer.ads(r)};n.prototype.setUpPlayerIntervals=function(){this.updateTimeIntervalHandle=setInterval(this.updateCurrentTime.bind(this),this.updateTimeInterval),this.seekCheckIntervalHandle=setInterval(this.checkForSeeking.bind(this),this.seekCheckInterval),this.resizeCheckIntervalHandle=setInterval(this.checkForResize.bind(this),this.resizeCheckInterval)},n.prototype.updateCurrentTime=function(){this.contentPlayheadTracker.seeking||(this.contentPlayheadTracker.currentTime=this.vjsPlayer.currentTime())},n.prototype.checkForSeeking=function(){var t=this.vjsPlayer.currentTime(),e=(t-this.contentPlayheadTracker.previousTime)*1e3;Math.abs(e)>this.seekCheckInterval+this.seekThreshold?this.contentPlayheadTracker.seeking=!0:this.contentPlayheadTracker.seeking=!1,this.contentPlayheadTracker.previousTime=this.vjsPlayer.currentTime()},n.prototype.checkForResize=function(){var t=this.getPlayerWidth(),e=this.getPlayerHeight();(t!=this.vjsPlayerDimensions.width||e!=this.vjsPlayerDimensions.height)&&(this.vjsPlayerDimensions.width=t,this.vjsPlayerDimensions.height=e,this.controller.onPlayerResize(t,e))},n.prototype.localContentEndedListener=function(){this.contentComplete||(this.contentComplete=!0,this.controller.onContentComplete());for(var t in this.contentEndedListeners)typeof this.contentEndedListeners[t]=="function"&&this.contentEndedListeners[t]();clearInterval(this.updateTimeIntervalHandle),clearInterval(this.seekCheckIntervalHandle),clearInterval(this.resizeCheckIntervalHandle),this.vjsPlayer.el()&&this.vjsPlayer.one("play",this.setUpPlayerIntervals.bind(this))},n.prototype.onNoPostroll=function(){this.vjsPlayer.trigger("nopostroll")},n.prototype.playerDisposedListener=function(){this.contentEndedListeners=[],this.controller.onPlayerDisposed(),this.contentComplete=!0,this.vjsPlayer.off("contentended",this.boundContentEndedListener),this.vjsPlayer.ads.adTimeoutTimeout&&clearTimeout(this.vjsPlayer.ads.adTimeoutTimeout);var t=[this.updateTimeIntervalHandle,this.seekCheckIntervalHandle,this.resizeCheckIntervalHandle];for(var e in t)t[e]&&clearInterval(t[e])},n.prototype.onReadyForPreroll=function(){this.controller.onPlayerReadyForPreroll()},n.prototype.onPlayerReady=function(){this.h5Player=document.getElementById(this.getPlayerId()).getElementsByClassName("vjs-tech")[0],this.h5Player.hasAttribute("autoplay")&&this.controller.setSetting("adWillAutoPlay",!0),this.onVolumeChange(),this.vjsPlayer.on("fullscreenchange",this.onFullscreenChange.bind(this)),this.vjsPlayer.on("volumechange",this.onVolumeChange.bind(this)),this.controller.onPlayerReady()},n.prototype.onFullscreenChange=function(){this.vjsPlayer.isFullscreen()?this.controller.onPlayerEnterFullscreen():this.controller.onPlayerExitFullscreen()},n.prototype.onVolumeChange=function(){var t=this.vjsPlayer.muted()?0:this.vjsPlayer.volume();this.controller.onPlayerVolumeChanged(t)},n.prototype.injectAdContainerDiv=function(t){this.vjsControls.el().parentNode.appendChild(t)},n.prototype.getContentPlayer=function(){return this.h5Player},n.prototype.getVolume=function(){return this.vjsPlayer.muted()?0:this.vjsPlayer.volume()},n.prototype.setVolume=function(t){this.vjsPlayer.volume(t),t==0?this.vjsPlayer.muted(!0):this.vjsPlayer.muted(!1)},n.prototype.unmute=function(){this.vjsPlayer.muted(!1)},n.prototype.mute=function(){this.vjsPlayer.muted(!0)},n.prototype.play=function(){this.vjsPlayer.play()},n.prototype.getPlayerWidth=function(){var t=(getComputedStyle(this.vjsPlayer.el())||{}).width;return(!t||parseFloat(t)===0)&&(t=(this.vjsPlayer.el().getBoundingClientRect()||{}).width),parseFloat(t)||this.vjsPlayer.width()},n.prototype.getPlayerHeight=function(){var t=(getComputedStyle(this.vjsPlayer.el())||{}).height;return(!t||parseFloat(t)===0)&&(t=(this.vjsPlayer.el().getBoundingClientRect()||{}).height),parseFloat(t)||this.vjsPlayer.height()},n.prototype.getPlayerOptions=function(){return this.vjsPlayer.options_},n.prototype.getPlayerId=function(){return this.vjsPlayer.id()},n.prototype.toggleFullscreen=function(){this.vjsPlayer.isFullscreen()?this.vjsPlayer.exitFullscreen():this.vjsPlayer.requestFullscreen()},n.prototype.getContentPlayheadTracker=function(){return this.contentPlayheadTracker},n.prototype.onAdError=function(t){this.vjsControls.show();var e=t.getError!==void 0?t.getError():t.stack;this.vjsPlayer.trigger({type:"adserror",data:{AdError:e,AdErrorEvent:t}})},n.prototype.onAdLog=function(t){var e=t.getAdData(),r=e.adError!==void 0?e.adError.getMessage():void 0;this.vjsPlayer.trigger({type:"adslog",data:{AdError:r,AdEvent:t}})},n.prototype.onAdBreakStart=function(){this.contentSource=this.vjsPlayer.currentSrc(),this.contentSourceType=this.vjsPlayer.currentType(),this.vjsPlayer.off("contentended",this.boundContentEndedListener),this.vjsPlayer.ads.startLinearAdMode(),this.vjsControls.hide(),this.vjsPlayer.pause()},n.prototype.onAdBreakEnd=function(){this.vjsPlayer.on("contentended",this.boundContentEndedListener),this.vjsPlayer.ads.inAdBreak()&&this.vjsPlayer.ads.endLinearAdMode(),this.vjsControls.show()},n.prototype.onAdStart=function(){this.vjsPlayer.trigger("ads-ad-started")},n.prototype.onAllAdsCompleted=function(){this.contentComplete==!0&&(this.contentSource&&this.vjsPlayer.currentSrc()!=this.contentSource&&this.vjsPlayer.src({src:this.contentSource,type:this.contentSourceType}),this.controller.onContentAndAdsCompleted())},n.prototype.onAdsReady=function(){this.vjsPlayer.trigger("adsready")},n.prototype.changeSource=function(t){this.vjsPlayer.currentSrc()&&(this.vjsPlayer.currentTime(0),this.vjsPlayer.pause()),t&&this.vjsPlayer.src(t),this.vjsPlayer.one("loadedmetadata",this.seekContentToZero.bind(this))},n.prototype.seekContentToZero=function(){this.vjsPlayer.currentTime(0)},n.prototype.triggerPlayerEvent=function(t,e){this.vjsPlayer.trigger(t,e)},n.prototype.addContentEndedListener=function(t){this.contentEndedListeners.push(t)},n.prototype.reset=function(){this.vjsPlayer.off("contentended",this.boundContentEndedListener),this.vjsPlayer.on("contentended",this.boundContentEndedListener),this.vjsControls.show(),this.vjsPlayer.ads.inAdBreak()&&this.vjsPlayer.ads.endLinearAdMode(),this.contentPlayheadTracker.currentTime=0,this.contentComplete=!1};var o=function(e){this.controller=e,this.adContainerDiv=document.createElement("div"),this.controlsDiv=document.createElement("div"),this.countdownDiv=document.createElement("div"),this.seekBarDiv=document.createElement("div"),this.progressDiv=document.createElement("div"),this.playPauseDiv=document.createElement("div"),this.muteDiv=document.createElement("div"),this.sliderDiv=document.createElement("div"),this.sliderLevelDiv=document.createElement("div"),this.fullscreenDiv=document.createElement("div"),this.boundOnMouseUp=this.onMouseUp.bind(this),this.boundOnMouseMove=this.onMouseMove.bind(this),this.adPlayheadTracker={currentTime:0,duration:0,isPod:!1,adPosition:0,totalAds:0},this.controlPrefix=this.controller.getPlayerId()+"_",this.showCountdown=!0,this.controller.getSettings().showCountdown===!1&&(this.showCountdown=!1),this.createAdContainer()};o.prototype.createAdContainer=function(){this.assignControlAttributes(this.adContainerDiv,"ima-ad-container"),this.adContainerDiv.style.position="absolute",this.adContainerDiv.style.zIndex=1111,this.adContainerDiv.addEventListener("mouseenter",this.showAdControls.bind(this),!1),this.adContainerDiv.addEventListener("mouseleave",this.hideAdControls.bind(this),!1),this.createControls(),this.controller.injectAdContainerDiv(this.adContainerDiv)},o.prototype.createControls=function(){this.assignControlAttributes(this.controlsDiv,"ima-controls-div"),this.controlsDiv.style.width="100%",this.controller.getIsMobile()?this.countdownDiv.style.display="none":(this.assignControlAttributes(this.countdownDiv,"ima-countdown-div"),this.countdownDiv.innerHTML=this.controller.getSettings().adLabel,this.countdownDiv.style.display=this.showCountdown?"block":"none"),this.assignControlAttributes(this.seekBarDiv,"ima-seek-bar-div"),this.seekBarDiv.style.width="100%",this.assignControlAttributes(this.progressDiv,"ima-progress-div"),this.assignControlAttributes(this.playPauseDiv,"ima-play-pause-div"),this.addClass(this.playPauseDiv,"ima-playing"),this.playPauseDiv.addEventListener("click",this.onAdPlayPauseClick.bind(this),!1),this.assignControlAttributes(this.muteDiv,"ima-mute-div"),this.addClass(this.muteDiv,"ima-non-muted"),this.muteDiv.addEventListener("click",this.onAdMuteClick.bind(this),!1),this.assignControlAttributes(this.sliderDiv,"ima-slider-div"),this.sliderDiv.addEventListener("mousedown",this.onAdVolumeSliderMouseDown.bind(this),!1),this.controller.getIsIos()&&(this.sliderDiv.style.display="none"),this.assignControlAttributes(this.sliderLevelDiv,"ima-slider-level-div"),this.assignControlAttributes(this.fullscreenDiv,"ima-fullscreen-div"),this.addClass(this.fullscreenDiv,"ima-non-fullscreen"),this.fullscreenDiv.addEventListener("click",this.onAdFullscreenClick.bind(this),!1),this.adContainerDiv.appendChild(this.controlsDiv),this.controlsDiv.appendChild(this.countdownDiv),this.controlsDiv.appendChild(this.seekBarDiv),this.controlsDiv.appendChild(this.playPauseDiv),this.controlsDiv.appendChild(this.muteDiv),this.controlsDiv.appendChild(this.sliderDiv),this.controlsDiv.appendChild(this.fullscreenDiv),this.seekBarDiv.appendChild(this.progressDiv),this.sliderDiv.appendChild(this.sliderLevelDiv)},o.prototype.onAdPlayPauseClick=function(){this.controller.onAdPlayPauseClick()},o.prototype.onAdMuteClick=function(){this.controller.onAdMuteClick()},o.prototype.onAdFullscreenClick=function(){this.controller.toggleFullscreen()},o.prototype.onAdsPaused=function(){this.controller.sdkImpl.adPlaying=!1,this.addClass(this.playPauseDiv,"ima-paused"),this.removeClass(this.playPauseDiv,"ima-playing"),this.showAdControls()},o.prototype.onAdsResumed=function(){this.onAdsPlaying(),this.showAdControls()},o.prototype.onAdsPlaying=function(){this.controller.sdkImpl.adPlaying=!0,this.addClass(this.playPauseDiv,"ima-playing"),this.removeClass(this.playPauseDiv,"ima-paused")},o.prototype.updateAdUi=function(t,e,r,a,l){var p=Math.floor(e/60),h=Math.floor(e%60);h.toString().length<2&&(h="0"+h);var c=": ";l>1&&(c=" ("+a+" "+this.controller.getSettings().adLabelNofN+" "+l+"): "),this.countdownDiv.innerHTML=this.controller.getSettings().adLabel+c+p+":"+h;var j=t/r,R=j*100;this.progressDiv.style.width=R+"%"},o.prototype.unmute=function(){this.addClass(this.muteDiv,"ima-non-muted"),this.removeClass(this.muteDiv,"ima-muted"),this.sliderLevelDiv.style.width=this.controller.getPlayerVolume()*100+"%"},o.prototype.mute=function(){this.addClass(this.muteDiv,"ima-muted"),this.removeClass(this.muteDiv,"ima-non-muted"),this.sliderLevelDiv.style.width="0%"},o.prototype.onAdVolumeSliderMouseDown=function(){document.addEventListener("mouseup",this.boundOnMouseUp,!1),document.addEventListener("mousemove",this.boundOnMouseMove,!1)},o.prototype.onMouseMove=function(t){this.changeVolume(t)},o.prototype.onMouseUp=function(t){this.changeVolume(t),document.removeEventListener("mouseup",this.boundOnMouseUp),document.removeEventListener("mousemove",this.boundOnMouseMove)},o.prototype.changeVolume=function(t){var e=(t.clientX-this.sliderDiv.getBoundingClientRect().left)/this.sliderDiv.offsetWidth;e*=100,e=Math.min(Math.max(e,0),100),this.sliderLevelDiv.style.width=e+"%",this.percent==0?(this.addClass(this.muteDiv,"ima-muted"),this.removeClass(this.muteDiv,"ima-non-muted")):(this.addClass(this.muteDiv,"ima-non-muted"),this.removeClass(this.muteDiv,"ima-muted")),this.controller.setVolume(e/100)},o.prototype.showAdContainer=function(){this.adContainerDiv.style.display="block"},o.prototype.hideAdContainer=function(){this.adContainerDiv.style.display="none"},o.prototype.reset=function(){this.hideAdContainer()},o.prototype.onAdError=function(){this.hideAdContainer()},o.prototype.onAdBreakStart=function(t){this.showAdContainer();var e=t.getAd().getContentType();e==="application/javascript"&&!this.controller.getSettings().showControlsForJSAds?this.controlsDiv.style.display="none":this.controlsDiv.style.display="block",this.onAdsPlaying(),this.hideAdControls()},o.prototype.onAdBreakEnd=function(){var t=this.controller.getCurrentAd();(t==null||t.isLinear())&&this.hideAdContainer(),this.controlsDiv.style.display="none",this.countdownDiv.innerHTML=""},o.prototype.onAllAdsCompleted=function(){this.hideAdContainer()},o.prototype.onLinearAdStart=function(){this.removeClass(this.adContainerDiv,"bumpable-ima-ad-container")},o.prototype.onNonLinearAdLoad=function(){this.adContainerDiv.style.display="block",this.addClass(this.adContainerDiv,"bumpable-ima-ad-container")},o.prototype.onPlayerEnterFullscreen=function(){this.addClass(this.fullscreenDiv,"ima-fullscreen"),this.removeClass(this.fullscreenDiv,"ima-non-fullscreen")},o.prototype.onPlayerExitFullscreen=function(){this.addClass(this.fullscreenDiv,"ima-non-fullscreen"),this.removeClass(this.fullscreenDiv,"ima-fullscreen")},o.prototype.onPlayerVolumeChanged=function(t){t==0?(this.addClass(this.muteDiv,"ima-muted"),this.removeClass(this.muteDiv,"ima-non-muted"),this.sliderLevelDiv.style.width="0%"):(this.addClass(this.muteDiv,"ima-non-muted"),this.removeClass(this.muteDiv,"ima-muted"),this.sliderLevelDiv.style.width=t*100+"%")},o.prototype.showAdControls=function(){this.addClass(this.controlsDiv,"ima-controls-div-showing")},o.prototype.hideAdControls=function(){this.removeClass(this.controlsDiv,"ima-controls-div-showing")},o.prototype.assignControlAttributes=function(t,e){t.id=this.controlPrefix+e,t.className=this.controlPrefix+e+" "+e},o.prototype.getClassRegexp=function(t){return new RegExp("(^|[^A-Za-z-])"+t+"((?![A-Za-z-])|$)","gi")},o.prototype.elementHasClass=function(t,e){var r=this.getClassRegexp(e);return r.test(t.className)},o.prototype.addClass=function(t,e){t.className=t.className.trim()+" "+e},o.prototype.removeClass=function(t,e){var r=this.getClassRegexp(e);t.className=t.className.trim().replace(r,"")},o.prototype.getAdContainerDiv=function(){return this.adContainerDiv},o.prototype.setShowCountdown=function(t){this.showCountdown=t,this.countdownDiv.style.display=this.showCountdown?"block":"none"};var y="videojs-ima",g="1.7.4",v="Apache-2.0",f="./dist/videojs.ima.js",m="./dist/videojs.ima.es.js",A={name:"Google Inc."},C={node:">=0.8.0"},P={contBuild:"watch 'npm run rollup:max' src",predevServer:'echo "Starting up server on localhost:8000."',devServer:"npm-run-all -p testServer contBuild",lint:'eslint "src/*.js"',rollup:"npm-run-all rollup:*","rollup:max":"rollup -c configs/rollup.config.js","rollup:es":"rollup -c configs/rollup.config.es.js","rollup:min":"rollup -c configs/rollup.config.min.js",pretest:"npm run rollup",start:"npm run devServer",test:"npm-run-all test:*","test:vjs5":"npm install video.js@5.19.2 --no-save && npm-run-all -p -r testServer webdriver","test:vjs6":"npm install video.js@6 --no-save && npm-run-all -p -r testServer webdriver","test:vjs7":"npm install video.js@7 --no-save && npm-run-all -p -r testServer webdriver",testServer:"http-server --cors -p 8000 --silent",preversion:"node scripts/preversion.js && npm run lint && npm test",version:"node scripts/version.js",postversion:"node scripts/postversion.js",webdriver:"mocha test/webdriver/*.js --no-timeouts"},L={type:"git",url:"https://github.com/googleads/videojs-ima"},D=["CHANGELOG.md","LICENSE","README.md","dist/","src/"],E={"can-autoplay":"^3.0.0",cryptiles:"^4.1.2",extend:">=3.0.2",lodash:">=4.17.13","lodash.template":">=4.5.0","video.js":"^5.19.2 || ^6 || ^7","videojs-contrib-ads":"^6"},k={"babel-core":"^6.26.3","babel-preset-env":"^1.7.0",child_process:"^1.0.2",chromedriver:"^2.35.0","conventional-changelog-cli":"^2.0.21","conventional-changelog-videojs":"^3.0.0",eslint:"^4.11.0","eslint-config-google":"^0.9.1","eslint-plugin-jsdoc":"^3.2.0",geckodriver:"^1.16.2","http-server":"^0.10.0",mocha:"^5.0.3","npm-run-all":"^4.1.2",path:"^0.12.7",rimraf:"^2.6.2",rollup:"^0.51.8","rollup-plugin-babel":"^3.0.3","rollup-plugin-copy":"^0.2.3","rollup-plugin-json":"^2.3.0","rollup-plugin-uglify":"^2.0.1","selenium-webdriver":"^3.6.0","uglify-es":"^3.1.10",watch:"^1.0.2"},M=["videojs","videojs-plugin"],S={name:y,version:g,license:v,main:f,module:m,author:A,engines:C,scripts:P,repository:L,files:D,dependencies:E,devDependencies:k,keywords:M},b=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},s=function(e){this.controller=e,this.adDisplayContainer=null,this.adDisplayContainerInitialized=!1,this.adsLoader=null,this.adsManager=null,this.adsRenderingSettings=null,this.adsResponse=null,this.currentAd=null,this.adTrackingTimer=null,this.allAdsCompleted=!1,this.adsActive=!1,this.adPlaying=!1,this.adMuted=!1,this.adBreakReadyListener=void 0,this.contentCompleteCalled=!1,this.adsManagerDimensions={width:0,height:0},this.autoPlayAdBreaks=!0,this.controller.getSettings().autoPlayAdBreaks===!1&&(this.autoPlayAdBreaks=!1),this.controller.getSettings().locale&&google.ima.settings.setLocale(this.controller.getSettings().locale),this.controller.getSettings().disableFlashAds&&google.ima.settings.setDisableFlashAds(this.controller.getSettings().disableFlashAds),this.controller.getSettings().disableCustomPlaybackForIOS10Plus&&google.ima.settings.setDisableCustomPlaybackForIOS10Plus(this.controller.getSettings().disableCustomPlaybackForIOS10Plus)};s.prototype.initAdObjects=function(){this.adDisplayContainer=new google.ima.AdDisplayContainer(this.controller.getAdContainerDiv(),this.controller.getContentPlayer()),this.adsLoader=new google.ima.AdsLoader(this.adDisplayContainer),this.adsLoader.getSettings().setVpaidMode(google.ima.ImaSdkSettings.VpaidMode.ENABLED),this.controller.getSettings().vpaidAllowed==!1&&this.adsLoader.getSettings().setVpaidMode(google.ima.ImaSdkSettings.VpaidMode.DISABLED),this.controller.getSettings().vpaidMode&&this.adsLoader.getSettings().setVpaidMode(this.controller.getSettings().vpaidMode),this.controller.getSettings().locale&&this.adsLoader.getSettings().setLocale(this.controller.getSettings().locale),this.controller.getSettings().numRedirects&&this.adsLoader.getSettings().setNumRedirects(this.controller.getSettings().numRedirects),this.adsLoader.getSettings().setPlayerType("videojs-ima"),this.adsLoader.getSettings().setPlayerVersion(S.version),this.adsLoader.getSettings().setAutoPlayAdBreaks(this.autoPlayAdBreaks),this.adsLoader.addEventListener(google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,this.onAdsManagerLoaded.bind(this),!1),this.adsLoader.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,this.onAdsLoaderError.bind(this),!1),this.controller.playerWrapper.vjsPlayer.trigger({type:"ads-loader",adsLoader:this.adsLoader})},s.prototype.requestAds=function(){var t=new google.ima.AdsRequest;this.controller.getSettings().adTagUrl?t.adTagUrl=this.controller.getSettings().adTagUrl:t.adsResponse=this.controller.getSettings().adsResponse,this.controller.getSettings().forceNonLinearFullSlot&&(t.forceNonLinearFullSlot=!0),this.controller.getSettings().vastLoadTimeout&&(t.vastLoadTimeout=this.controller.getSettings().vastLoadTimeout),t.linearAdSlotWidth=this.controller.getPlayerWidth(),t.linearAdSlotHeight=this.controller.getPlayerHeight(),t.nonLinearAdSlotWidth=this.controller.getSettings().nonLinearWidth||this.controller.getPlayerWidth(),t.nonLinearAdSlotHeight=this.controller.getSettings().nonLinearHeight||this.controller.getPlayerHeight(),t.setAdWillAutoPlay(this.controller.adsWillAutoplay()),t.setAdWillPlayMuted(this.controller.adsWillPlayMuted());var e=this.controller.getSettings().adsRequest;e&&(typeof e>"u"?"undefined":b(e))==="object"&&Object.keys(e).forEach(function(r){t[r]=e[r]}),this.adsLoader.requestAds(t),this.controller.playerWrapper.vjsPlayer.trigger({type:"ads-request",AdsRequest:t})},s.prototype.onAdsManagerLoaded=function(t){this.createAdsRenderingSettings(),this.adsManager=t.getAdsManager(this.controller.getContentPlayheadTracker(),this.adsRenderingSettings),this.adsManager.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,this.onAdError.bind(this)),this.adsManager.addEventListener(google.ima.AdEvent.Type.AD_BREAK_READY,this.onAdBreakReady.bind(this)),this.adsManager.addEventListener(google.ima.AdEvent.Type.CONTENT_PAUSE_REQUESTED,this.onContentPauseRequested.bind(this)),this.adsManager.addEventListener(google.ima.AdEvent.Type.CONTENT_RESUME_REQUESTED,this.onContentResumeRequested.bind(this)),this.adsManager.addEventListener(google.ima.AdEvent.Type.ALL_ADS_COMPLETED,this.onAllAdsCompleted.bind(this)),this.adsManager.addEventListener(google.ima.AdEvent.Type.LOADED,this.onAdLoaded.bind(this)),this.adsManager.addEventListener(google.ima.AdEvent.Type.STARTED,this.onAdStarted.bind(this)),this.adsManager.addEventListener(google.ima.AdEvent.Type.COMPLETE,this.onAdComplete.bind(this)),this.adsManager.addEventListener(google.ima.AdEvent.Type.SKIPPED,this.onAdComplete.bind(this)),this.adsManager.addEventListener(google.ima.AdEvent.Type.LOG,this.onAdLog.bind(this)),this.controller.getIsMobile()&&(this.adsManager.addEventListener(google.ima.AdEvent.Type.PAUSED,this.onAdPaused.bind(this)),this.adsManager.addEventListener(google.ima.AdEvent.Type.RESUMED,this.onAdResumed.bind(this))),this.controller.playerWrapper.vjsPlayer.trigger({type:"ads-manager",adsManager:this.adsManager}),this.autoPlayAdBreaks||this.initAdsManager(),this.controller.onAdsReady(),this.controller.getSettings().adsManagerLoadedCallback&&this.controller.getSettings().adsManagerLoadedCallback()},s.prototype.onAdsLoaderError=function(t){window.console.warn("AdsLoader error: "+t.getError()),this.controller.onErrorLoadingAds(t),this.adsManager&&this.adsManager.destroy()},s.prototype.initAdsManager=function(){try{var t=this.controller.getPlayerWidth(),e=this.controller.getPlayerHeight();this.adsManagerDimensions.width=t,this.adsManagerDimensions.height=e,this.adsManager.init(t,e,google.ima.ViewMode.NORMAL),this.adsManager.setVolume(this.controller.getPlayerVolume()),this.initializeAdDisplayContainer()}catch(r){this.onAdError(r)}},s.prototype.createAdsRenderingSettings=function(){if(this.adsRenderingSettings=new google.ima.AdsRenderingSettings,this.adsRenderingSettings.restoreCustomPlaybackStateOnAdBreakComplete=!0,this.controller.getSettings().adsRenderingSettings)for(var t in this.controller.getSettings().adsRenderingSettings)t!==""&&(this.adsRenderingSettings[t]=this.controller.getSettings().adsRenderingSettings[t])},s.prototype.onAdError=function(t){var e=t.getError!==void 0?t.getError():t.stack;window.console.warn("Ad error: "+e),this.adsManager.destroy(),this.controller.onAdError(t),this.adsActive=!1,this.adPlaying=!1},s.prototype.onAdBreakReady=function(t){this.adBreakReadyListener(t)},s.prototype.onContentPauseRequested=function(t){this.adsActive=!0,this.adPlaying=!0,this.controller.onAdBreakStart(t)},s.prototype.onContentResumeRequested=function(t){this.adsActive=!1,this.adPlaying=!1,this.controller.onAdBreakEnd()},s.prototype.onAllAdsCompleted=function(t){this.allAdsCompleted=!0,this.controller.onAllAdsCompleted()},s.prototype.onAdLoaded=function(t){t.getAd().isLinear()||(this.controller.onNonLinearAdLoad(),this.controller.playContent())},s.prototype.onAdStarted=function(t){this.currentAd=t.getAd(),this.currentAd.isLinear()?(this.adTrackingTimer=setInterval(this.onAdPlayheadTrackerInterval.bind(this),250),this.controller.onLinearAdStart()):this.controller.onNonLinearAdStart()},s.prototype.onAdPaused=function(){this.controller.onAdsPaused()},s.prototype.onAdResumed=function(t){this.controller.onAdsResumed()},s.prototype.onAdComplete=function(){this.currentAd.isLinear()&&clearInterval(this.adTrackingTimer)},s.prototype.onAdLog=function(t){this.controller.onAdLog(t)},s.prototype.onAdPlayheadTrackerInterval=function(){if(this.adsManager!==null){var t=this.adsManager.getRemainingTime(),e=this.currentAd.getDuration(),r=e-t;r=r>0?r:0;var a=0,l=void 0;this.currentAd.getAdPodInfo()&&(l=this.currentAd.getAdPodInfo().getAdPosition(),a=this.currentAd.getAdPodInfo().getTotalAds()),this.controller.onAdPlayheadUpdated(r,t,e,l,a)}},s.prototype.onContentComplete=function(){this.adsLoader&&(this.adsLoader.contentComplete(),this.contentCompleteCalled=!0),this.adsManager&&this.adsManager.getCuePoints()&&!this.adsManager.getCuePoints().includes(-1)&&this.controller.onNoPostroll(),this.allAdsCompleted&&this.controller.onContentAndAdsCompleted()},s.prototype.onPlayerDisposed=function(){this.adTrackingTimer&&clearInterval(this.adTrackingTimer),this.adsManager&&(this.adsManager.destroy(),this.adsManager=null)},s.prototype.onPlayerReadyForPreroll=function(){if(this.autoPlayAdBreaks){this.initAdsManager();try{this.controller.showAdContainer(),this.adsManager.setVolume(this.controller.getPlayerVolume()),this.adsManager.start()}catch(t){this.onAdError(t)}}},s.prototype.onPlayerReady=function(){this.initAdObjects(),(this.controller.getSettings().adTagUrl||this.controller.getSettings().adsResponse)&&this.controller.getSettings().requestMode==="onLoad"&&this.requestAds()},s.prototype.onPlayerEnterFullscreen=function(){this.adsManager&&this.adsManager.resize(window.screen.width,window.screen.height,google.ima.ViewMode.FULLSCREEN)},s.prototype.onPlayerExitFullscreen=function(){this.adsManager&&this.adsManager.resize(this.controller.getPlayerWidth(),this.controller.getPlayerHeight(),google.ima.ViewMode.NORMAL)},s.prototype.onPlayerVolumeChanged=function(t){this.adsManager&&this.adsManager.setVolume(t),t==0?this.adMuted=!0:this.adMuted=!1},s.prototype.onPlayerResize=function(t,e){this.adsManager&&(this.adsManagerDimensions.width=t,this.adsManagerDimensions.height=e,this.adsManager.resize(t,e,google.ima.ViewMode.NORMAL))},s.prototype.getCurrentAd=function(){return this.currentAd},s.prototype.setAdBreakReadyListener=function(t){this.adBreakReadyListener=t},s.prototype.isAdPlaying=function(){return this.adPlaying},s.prototype.isAdMuted=function(){return this.adMuted},s.prototype.pauseAds=function(){this.adsManager.pause(),this.adPlaying=!1},s.prototype.resumeAds=function(){this.adsManager.resume(),this.adPlaying=!0},s.prototype.unmute=function(){this.adsManager.setVolume(1),this.adMuted=!1},s.prototype.mute=function(){this.adsManager.setVolume(0),this.adMuted=!0},s.prototype.setVolume=function(t){this.adsManager.setVolume(t),t==0?this.adMuted=!0:this.adMuted=!1},s.prototype.initializeAdDisplayContainer=function(){this.adDisplayContainer&&(this.adDisplayContainerInitialized||(this.adDisplayContainer.initialize(),this.adDisplayContainerInitialized=!0))},s.prototype.playAdBreak=function(){this.autoPlayAdBreaks||(this.controller.showAdContainer(),this.adsManager.setVolume(this.controller.getPlayerVolume()),this.adsManager.start())},s.prototype.addEventListener=function(t,e){this.adsManager&&this.adsManager.addEventListener(t,e)},s.prototype.getAdsManager=function(){return this.adsManager},s.prototype.reset=function(){this.adsActive=!1,this.adPlaying=!1,this.adTrackingTimer&&clearInterval(this.adTrackingTimer),this.adsManager&&(this.adsManager.destroy(),this.adsManager=null),this.adsLoader&&!this.contentCompleteCalled&&this.adsLoader.contentComplete(),this.contentCompleteCalled=!1,this.allAdsCompleted=!1};var i=function(e,r){this.settings={},this.contentAndAdsEndedListeners=[],this.isMobile=navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/Android/i),this.isIos=navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i),this.initWithSettings(r);var a={debug:this.settings.debug,timeout:this.settings.timeout,prerollTimeout:this.settings.prerollTimeout},l=this.extend({},a,r.contribAdsSettings||{});this.playerWrapper=new n(e,l,this),this.adUi=new o(this),this.sdkImpl=new s(this)};i.IMA_DEFAULTS={debug:!1,timeout:5e3,prerollTimeout:1e3,adLabel:"Advertisement",adLabelNofN:"of",showControlsForJSAds:!0,requestMode:"onLoad"},i.prototype.initWithSettings=function(t){this.settings=this.extend({},i.IMA_DEFAULTS,t||{}),this.warnAboutDeprecatedSettings(),this.showCountdown=!0,this.settings.showCountdown===!1&&(this.showCountdown=!1)},i.prototype.warnAboutDeprecatedSettings=function(){var t=this,e=["adWillAutoplay","adsWillAutoplay","adWillPlayMuted","adsWillPlayMuted"];e.forEach(function(r){t.settings[r]!==void 0&&console.warn("WARNING: videojs.ima setting "+r+" is deprecated")})},i.prototype.getSettings=function(){return this.settings},i.prototype.getIsMobile=function(){return this.isMobile},i.prototype.getIsIos=function(){return this.isIos},i.prototype.injectAdContainerDiv=function(t){this.playerWrapper.injectAdContainerDiv(t)},i.prototype.getAdContainerDiv=function(){return this.adUi.getAdContainerDiv()},i.prototype.getContentPlayer=function(){return this.playerWrapper.getContentPlayer()},i.prototype.getContentPlayheadTracker=function(){return this.playerWrapper.getContentPlayheadTracker()},i.prototype.requestAds=function(){this.sdkImpl.requestAds()},i.prototype.setSetting=function(t,e){this.settings[t]=e},i.prototype.onErrorLoadingAds=function(t){this.adUi.onAdError(),this.playerWrapper.onAdError(t)},i.prototype.onAdPlayPauseClick=function(){this.sdkImpl.isAdPlaying()?(this.adUi.onAdsPaused(),this.sdkImpl.pauseAds()):(this.adUi.onAdsPlaying(),this.sdkImpl.resumeAds())},i.prototype.onAdMuteClick=function(){this.sdkImpl.isAdMuted()?(this.playerWrapper.unmute(),this.adUi.unmute(),this.sdkImpl.unmute()):(this.playerWrapper.mute(),this.adUi.mute(),this.sdkImpl.mute())},i.prototype.setVolume=function(t){this.playerWrapper.setVolume(t),this.sdkImpl.setVolume(t)},i.prototype.getPlayerVolume=function(){return this.playerWrapper.getVolume()},i.prototype.toggleFullscreen=function(){this.playerWrapper.toggleFullscreen()},i.prototype.onAdError=function(t){this.adUi.onAdError(),this.playerWrapper.onAdError(t)},i.prototype.onAdBreakStart=function(t){this.playerWrapper.onAdBreakStart(),this.adUi.onAdBreakStart(t)},i.prototype.showAdContainer=function(){this.adUi.showAdContainer()},i.prototype.onAdBreakEnd=function(){this.playerWrapper.onAdBreakEnd(),this.adUi.onAdBreakEnd()},i.prototype.onAllAdsCompleted=function(){this.adUi.onAllAdsCompleted(),this.playerWrapper.onAllAdsCompleted()},i.prototype.onAdsPaused=function(){this.adUi.onAdsPaused()},i.prototype.onAdsResumed=function(){this.adUi.onAdsResumed()},i.prototype.onAdPlayheadUpdated=function(t,e,r,a,l){this.adUi.updateAdUi(t,e,r,a,l)},i.prototype.onAdLog=function(t){this.playerWrapper.onAdLog(t)},i.prototype.getCurrentAd=function(){return this.sdkImpl.getCurrentAd()},i.prototype.playContent=function(){this.playerWrapper.play()},i.prototype.onLinearAdStart=function(){this.adUi.onLinearAdStart(),this.playerWrapper.onAdStart()},i.prototype.onNonLinearAdLoad=function(){this.adUi.onNonLinearAdLoad()},i.prototype.onNonLinearAdStart=function(){this.adUi.onNonLinearAdLoad(),this.playerWrapper.onAdStart()},i.prototype.getPlayerWidth=function(){return this.playerWrapper.getPlayerWidth()},i.prototype.getPlayerHeight=function(){return this.playerWrapper.getPlayerHeight()},i.prototype.onAdsReady=function(){this.playerWrapper.onAdsReady()},i.prototype.onPlayerResize=function(t,e){this.sdkImpl.onPlayerResize(t,e)},i.prototype.onContentComplete=function(){this.sdkImpl.onContentComplete()},i.prototype.onNoPostroll=function(){this.playerWrapper.onNoPostroll()},i.prototype.onContentAndAdsCompleted=function(){for(var t in this.contentAndAdsEndedListeners)typeof this.contentAndAdsEndedListeners[t]=="function"&&this.contentAndAdsEndedListeners[t]()},i.prototype.onPlayerDisposed=function(){this.contentAndAdsEndedListeners=[],this.sdkImpl.onPlayerDisposed()},i.prototype.onPlayerReadyForPreroll=function(){this.sdkImpl.onPlayerReadyForPreroll()},i.prototype.onPlayerReady=function(){this.sdkImpl.onPlayerReady()},i.prototype.onPlayerEnterFullscreen=function(){this.adUi.onPlayerEnterFullscreen(),this.sdkImpl.onPlayerEnterFullscreen()},i.prototype.onPlayerExitFullscreen=function(){this.adUi.onPlayerExitFullscreen(),this.sdkImpl.onPlayerExitFullscreen()},i.prototype.onPlayerVolumeChanged=function(t){this.adUi.onPlayerVolumeChanged(t),this.sdkImpl.onPlayerVolumeChanged(t)},i.prototype.setContentWithAdTag=function(t,e){this.reset(),this.settings.adTagUrl=e||this.settings.adTagUrl,this.playerWrapper.changeSource(t)},i.prototype.setContentWithAdsResponse=function(t,e){this.reset(),this.settings.adsResponse=e||this.settings.adsResponse,this.playerWrapper.changeSource(t)},i.prototype.setContentWithAdsRequest=function(t,e){this.reset(),this.settings.adsRequest=e||this.settings.adsRequest,this.playerWrapper.changeSource(t)},i.prototype.reset=function(){this.sdkImpl.reset(),this.playerWrapper.reset(),this.adUi.reset()},i.prototype.addContentEndedListener=function(t){this.playerWrapper.addContentEndedListener(t)},i.prototype.addContentAndAdsEndedListener=function(t){this.contentAndAdsEndedListeners.push(t)},i.prototype.setAdBreakReadyListener=function(t){this.sdkImpl.setAdBreakReadyListener(t)},i.prototype.setShowCountdown=function(t){this.adUi.setShowCountdown(t),this.showCountdown=t,this.adUi.countdownDiv.style.display=this.showCountdown?"block":"none"},i.prototype.initializeAdDisplayContainer=function(){this.sdkImpl.initializeAdDisplayContainer()},i.prototype.playAdBreak=function(){this.sdkImpl.playAdBreak()},i.prototype.addEventListener=function(t,e){this.sdkImpl.addEventListener(t,e)},i.prototype.getAdsManager=function(){return this.sdkImpl.getAdsManager()},i.prototype.getPlayerId=function(){return this.playerWrapper.getPlayerId()},i.prototype.changeAdTag=function(t){this.reset(),this.settings.adTagUrl=t},i.prototype.pauseAd=function(){this.adUi.onAdsPaused(),this.sdkImpl.pauseAds()},i.prototype.resumeAd=function(){this.adUi.onAdsPlaying(),this.sdkImpl.resumeAds()},i.prototype.adsWillAutoplay=function(){return this.settings.adsWillAutoplay!==void 0?this.settings.adsWillAutoplay:this.settings.adWillAutoplay!==void 0?this.settings.adWillAutoplay:!!this.playerWrapper.getPlayerOptions().autoplay},i.prototype.adsWillPlayMuted=function(){return this.settings.adsWillPlayMuted!==void 0?this.settings.adsWillPlayMuted:this.settings.adWillPlayMuted!==void 0?this.settings.adWillPlayMuted:this.playerWrapper.getPlayerOptions().muted!==void 0?this.playerWrapper.getPlayerOptions().muted:this.playerWrapper.getVolume()==0},i.prototype.triggerPlayerEvent=function(t,e){this.playerWrapper.triggerPlayerEvent(t,e)},i.prototype.extend=function(t){for(var e=void 0,r=void 0,a=void 0,l=arguments.length,p=Array(l>1?l-1:0),h=1;h<l;h++)p[h-1]=arguments[h];for(r=0;r<p.length;r++){e=p[r];for(a in e)e.hasOwnProperty(a)&&(t[a]=e[a])}return t};var u=function(e,r){this.controller=new i(e,r),this.addContentAndAdsEndedListener=function(a){this.controller.addContentAndAdsEndedListener(a)}.bind(this),this.addContentEndedListener=function(a){this.controller.addContentEndedListener(a)}.bind(this),this.addEventListener=function(a,l){this.controller.addEventListener(a,l)}.bind(this),this.changeAdTag=function(a){this.controller.changeAdTag(a)}.bind(this),this.getAdsManager=function(){return this.controller.getAdsManager()}.bind(this),this.initializeAdDisplayContainer=function(){this.controller.initializeAdDisplayContainer()}.bind(this),this.pauseAd=function(){this.controller.pauseAd()}.bind(this),this.playAdBreak=function(){this.controller.playAdBreak()}.bind(this),this.requestAds=function(){this.controller.requestAds()}.bind(this),this.resumeAd=function(){this.controller.resumeAd()}.bind(this),this.setAdBreakReadyListener=function(a){this.controller.setAdBreakReadyListener(a)}.bind(this),this.setContentWithAdTag=function(a,l){this.controller.setContentWithAdTag(a,l)}.bind(this),this.setContentWithAdsResponse=function(a,l){this.controller.setContentWithAdsResponse(a,l)}.bind(this),this.setContentWithAdsRequest=function(a,l){this.controller.setContentWithAdsRequest(a,l)}.bind(this),this.setShowCountdown=function(a){this.controller.setShowCountdown(a)}.bind(this)},w=function(e){this.ima=new u(this,e)},T=d.registerPlugin||d.plugin;return T("ima",w),u});
//# sourceMappingURL=videojs.ima.2020.5d1da9e38d4dfc6926356436c42248a1.js.map
