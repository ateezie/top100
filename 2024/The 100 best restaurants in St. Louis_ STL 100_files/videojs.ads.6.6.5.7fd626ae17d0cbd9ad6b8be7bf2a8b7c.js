/*! @name videojs-contrib-ads @version 6.6.5 @license Apache-2.0 */(function(i,g){typeof exports=="object"&&typeof module<"u"?module.exports=g(require("video.js"),require("global/window"),require("global/document")):typeof define=="function"&&define.amd?define(["video.js","global/window","global/document"],g):(i=i||self,i.videojsContribAds=g(i.videojs,i.window,i.document))})(this,function(i,g,_){"use strict";i=i&&i.hasOwnProperty("default")?i.default:i,g=g&&g.hasOwnProperty("default")?g.default:g,_=_&&_.hasOwnProperty("default")?_.default:_;var B="6.6.5";function N(t){return{disableNextSnapshotRestore:!1,_contentEnding:!1,_contentHasEnded:!1,_hasThereBeenALoadStartDuringPlayerLife:!1,_hasThereBeenALoadedData:!1,_hasThereBeenALoadedMetaData:!1,_inLinearAdMode:!1,_shouldBlockPlay:!1,_playBlocked:!1,_playRequested:!1,adType:null,VERSION:B,reset:function(){t.ads.disableNextSnapshotRestore=!1,t.ads._contentEnding=!1,t.ads._contentHasEnded=!1,t.ads.snapshot=null,t.ads.adType=null,t.ads._hasThereBeenALoadedData=!1,t.ads._hasThereBeenALoadedMetaData=!1,t.ads._cancelledPlay=!1,t.ads._shouldBlockPlay=!1,t.ads._playBlocked=!1,t.ads.nopreroll_=!1,t.ads.nopostroll_=!1,t.ads._playRequested=!1},startLinearAdMode:function(){t.ads._state.startLinearAdMode()},endLinearAdMode:function(){t.ads._state.endLinearAdMode()},skipLinearAdMode:function(){t.ads._state.skipLinearAdMode()},stitchedAds:function(e){return e!==void 0&&(i.log.warn("Using player.ads.stitchedAds() as a setter is deprecated, it should be set as an option upon initialization of contrib-ads."),this.settings.stitchedAds=!!e),this.settings.stitchedAds},videoElementRecycled:function(){if(t.ads.shouldPlayContentBehindAd(t))return!1;if(!this.snapshot)throw new Error("You cannot use videoElementRecycled while there is no snapshot.");var e=t.tech_.src()!==this.snapshot.src,o=t.currentSrc()!==this.snapshot.currentSrc;return e||o},isLive:function(e){return e===void 0&&(e=t),typeof e.ads.settings.contentIsLive=="boolean"?e.ads.settings.contentIsLive:e.duration()===1/0?!0:i.browser.IOS_VERSION==="8"&&e.duration()===0},shouldPlayContentBehindAd:function(e){if(e===void 0&&(e=t),e)return e.ads.settings.liveCuePoints?!i.browser.IS_IOS&&!i.browser.IS_ANDROID&&e.duration()===1/0:!1;throw new Error("shouldPlayContentBehindAd requires a player as a param")},shouldTakeSnapshots:function(e){return e===void 0&&(e=t),!this.shouldPlayContentBehindAd(e)&&!this.stitchedAds()},isInAdMode:function(){return this._state.isAdState()},isWaitingForAdBreak:function(){return this._state.isWaitingForAdBreak()},isContentResuming:function(){return this._state.isContentResuming()},isAdPlaying:function(){return this._state.inAdBreak()},inAdBreak:function(){return this._state.inAdBreak()},removeNativePoster:function(){var e=t.$(".vjs-tech");e&&e.removeAttribute("poster")},debug:function(){if(this.settings.debug){for(var e=arguments.length,o=new Array(e),n=0;n<e;n++)o[n]=arguments[n];o.length===1&&typeof o[0]=="string"?i.log("ADS: "+o[0]):i.log.apply(i,["ADS:"].concat(o))}}}}var w=function(a,e){e.isImmediatePropagationStopped=function(){return!0},e.cancelBubble=!0,e.isPropagationStopped=function(){return!0}},m=function(a,e,o){w(a,o),a.trigger({type:e+o.type,originalEvent:o})},I=function(a,e){a.ads.isInAdMode()&&(a.ads.isContentResuming()?a.ads._contentEnding&&m(a,"content",e):m(a,"ad",e))},x=function(a,e){a.ads.isInAdMode()?a.ads.isContentResuming()?(w(a,e),a.trigger("resumeended")):m(a,"ad",e):!a.ads._contentHasEnded&&!a.ads.stitchedAds()&&(m(a,"content",e),a.trigger("readyforpostroll"))},D=function(a,e){if(!(e.type==="loadstart"&&!a.ads._hasThereBeenALoadStartDuringPlayerLife||e.type==="loadeddata"&&!a.ads._hasThereBeenALoadedData||e.type==="loadedmetadata"&&!a.ads._hasThereBeenALoadedMetaData))if(a.ads.inAdBreak())m(a,"ad",e);else{if(a.currentSrc()!==a.ads.contentSrc)return;m(a,"content",e)}},O=function(a,e){a.ads.inAdBreak()?m(a,"ad",e):a.ads.isContentResuming()&&m(a,"content",e)};function F(t){t.type==="playing"?I(this,t):t.type==="ended"?x(this,t):t.type==="loadstart"||t.type==="loadeddata"||t.type==="loadedmetadata"?D(this,t):t.type==="play"?O(this,t):this.ads.isInAdMode()&&(this.ads.isContentResuming()?m(this,"content",t):m(this,"ad",t))}function U(t){t.ads.contentSrc=t.currentSrc(),t.ads._seenInitialLoadstart=!1;var a=function(){if(!t.ads.inAdBreak()){var o=t.currentSrc();o!==t.ads.contentSrc&&(t.ads._seenInitialLoadstart&&t.trigger({type:"contentchanged"}),t.trigger({type:"contentupdate",oldValue:t.ads.contentSrc,newValue:o}),t.ads.contentSrc=o),t.ads._seenInitialLoadstart=!0}};t.on("loadstart",a)}var y=function(a,e){return e?encodeURIComponent(a):a},E=function(a,e,o){if(a&&a[o])for(var n=a[o],r=Object.keys(n),s=0;s<r.length;s++){var u="{mediainfo."+o+"."+r[s]+"}";e[u]=n[r[s]]}};function $(t,a,e){var o=this,n={};t=t.replace(/{([^}=]+)=([^}]+)}/g,function(l,c,f){return n["{"+c+"}"]=f,"{"+c+"}"}),a===void 0&&(a=!1);var r={};e!==void 0&&(r=e),r["{player.id}"]=this.options_["data-player"],r["{mediainfo.id}"]=this.mediainfo?this.mediainfo.id:"",r["{mediainfo.name}"]=this.mediainfo?this.mediainfo.name:"",r["{mediainfo.duration}"]=this.mediainfo?this.mediainfo.duration:"",r["{player.duration}"]=this.duration(),r["{timestamp}"]=new Date().getTime(),r["{document.referrer}"]=_.referrer,r["{window.location.href}"]=g.location.href,r["{random}"]=Math.floor(Math.random()*1e12),["description","tags","reference_id","ad_keys"].forEach(function(l){o.mediainfo&&o.mediainfo[l]?r["{mediainfo."+l+"}"]=o.mediainfo[l]:n["{mediainfo."+l+"}"]?r["{mediainfo."+l+"}"]=n["{mediainfo."+l+"}"]:r["{mediainfo."+l+"}"]=""}),E(this.mediainfo,r,"custom_fields"),E(this.mediainfo,r,"customFields");for(var s in r)t=t.split(s).join(y(r[s],a));t=t.replace(/{pageVariable\.([^}]+)}/g,function(l,c){for(var f,A=g,h=c.split("."),p=0;p<h.length;p++)p===h.length-1?f=A[h[p]]:A=A[h[p]];var k=typeof f;return f===null?"null":f===void 0?n["{pageVariable."+c+"}"]?n["{pageVariable."+c+"}"]:(i.log.warn('Page variable "'+c+'" not found'),""):k!=="string"&&k!=="number"&&k!=="boolean"?(i.log.warn('Page variable "'+c+'" is not a supported type'),""):y(String(f),a)});for(var u in n)t=t.replace(u,n[u]);return t}var P={};P.processMetadataTracks=function(t,a){for(var e=t.textTracks(),o=function(s){s.kind==="metadata"&&(t.ads.cueTextTracks.setMetadataTrackMode(s),a(t,s))},n=0;n<e.length;n++)o(e[n]);e.addEventListener("addtrack",function(r){o(r.track)})},P.setMetadataTrackMode=function(t){},P.getSupportedAdCue=function(t,a){return a},P.isSupportedAdCue=function(t,a){return!0},P.getCueId=function(t,a){return a.id};var V=function(a,e){return e!==void 0&&a.ads.includedCues[e]},q=function(a,e){e!==void 0&&e!==""&&(a.ads.includedCues[e]=!0)};P.processAdTrack=function(t,a,e,o){t.ads.includedCues={};for(var n=0;n<a.length;n++){var r=a[n],s=this.getSupportedAdCue(t,r);if(!this.isSupportedAdCue(t,r)){i.log.warn("Skipping as this is not a supported ad cue.",r);return}var u=this.getCueId(t,r),l=r.startTime;if(V(t,u)){i.log("Skipping ad already seen with ID "+u);return}o&&o(t,s,u,l),e(t,s,u,l),q(t,u)}};function W(t,a){a&&i.log("Using cancelContentPlay to block content playback"),t.on("play",H)}function H(){this.ads._shouldBlockPlay!==!1&&(this.paused()||(this.ads.debug("Playback was canceled by cancelContentPlay"),this.pause()),this.ads._cancelledPlay=!0)}var T={},C=i;T.isMiddlewareMediatorSupported=function(){return C.browser.IS_IOS||C.browser.IS_ANDROID?!1:!!(C.use&&C.middleware&&C.middleware.TERMINATOR)},T.playMiddleware=function(t){return{setSource:function(e,o){o(null,e)},callPlay:function(){if(t.ads&&t.ads._shouldBlockPlay===!0)return t.ads.debug("Using playMiddleware to block content playback"),t.ads._playBlocked=!0,C.middleware.TERMINATOR},play:function(e,o){t.ads&&t.ads._playBlocked&&e?(t.ads.debug("Play call to Tech was terminated."),t.trigger("play"),t.addClass("vjs-has-started"),t.ads._playBlocked=!1):o&&o.catch&&o.catch(function(n){n.name==="NotAllowedError"&&!i.browser.IS_SAFARI&&t.trigger("pause")})}}},T.testHook=function(t){C=t};var z=T.playMiddleware,Y=T.isMiddlewareMediatorSupported,G=function(){if(i.getPlugin)return!!i.getPlugin("ads");var a=i.getComponent("Player");return!!(a&&a.prototype.ads)};function J(t){if(G(i))return!1;var a=i.registerPlugin||i.plugin;return a("ads",t),Y()&&!i.usingContribAdsMiddleware_&&(i.use("*",z),i.usingContribAdsMiddleware_=!0,i.log.debug("Play middleware has been registered with videojs")),!0}var d=function(){function t(){}return t.getState=function(e){if(e&&t.states_&&t.states_[e])return t.states_[e]},t.registerState=function(e,o){if(typeof e!="string"||!e)throw new Error('Illegal state name, "'+e+'"; must be a non-empty string.');return t.states_||(t.states_={}),t.states_[e]=o,o},t}(),b=function(){t._getName=function(){return"Anonymous State"};function t(e){this.player=e}var a=t.prototype;return a.transitionTo=function(o){var n=this.player;this.cleanup(n);var r=new o(n);n.ads._state=r,n.ads.debug(this.constructor._getName()+" -> "+r.constructor._getName());for(var s=arguments.length,u=new Array(s>1?s-1:0),l=1;l<s;l++)u[l-1]=arguments[l];r.init.apply(r,[n].concat(u))},a.init=function(){},a.cleanup=function(){},a.onPlay=function(){},a.onPlaying=function(){},a.onEnded=function(){},a.onAdEnded=function(){},a.onAdsReady=function(){i.log.warn("Unexpected adsready event")},a.onAdsError=function(){},a.onAdsCanceled=function(){},a.onAdTimeout=function(){},a.onAdStarted=function(){},a.onContentChanged=function(){},a.onContentResumed=function(){},a.onReadyForPostroll=function(){i.log.warn("Unexpected readyforpostroll event")},a.onNoPreroll=function(){},a.onNoPostroll=function(){},a.startLinearAdMode=function(){i.log.warn("Unexpected startLinearAdMode invocation (State via "+this.constructor._getName()+")")},a.endLinearAdMode=function(){i.log.warn("Unexpected endLinearAdMode invocation (State via "+this.constructor._getName()+")")},a.skipLinearAdMode=function(){i.log.warn("Unexpected skipLinearAdMode invocation (State via "+this.constructor._getName()+")")},a.isAdState=function(){throw new Error("isAdState unimplemented for "+this.constructor._getName())},a.isWaitingForAdBreak=function(){return!1},a.isContentResuming=function(){return!1},a.inAdBreak=function(){return!1},a.handleEvent=function(o){var n=this.player;o==="play"?this.onPlay(n):o==="adsready"?this.onAdsReady(n):o==="adserror"?this.onAdsError(n):o==="adscanceled"?this.onAdsCanceled(n):o==="adtimeout"?this.onAdTimeout(n):o==="ads-ad-started"?this.onAdStarted(n):o==="contentchanged"?this.onContentChanged(n):o==="contentresumed"?this.onContentResumed(n):o==="readyforpostroll"?this.onReadyForPostroll(n):o==="playing"?this.onPlaying(n):o==="ended"?this.onEnded(n):o==="nopreroll"?this.onNoPreroll(n):o==="nopostroll"?this.onNoPostroll(n):o==="adended"&&this.onAdEnded(n)},t}();d.registerState("State",b);function v(t,a){t.prototype=Object.create(a.prototype),t.prototype.constructor=t,t.__proto__=a}var K=function(t){v(a,t);function a(o){var n;return n=t.call(this,o)||this,n.contentResuming=!1,n.waitingForAdBreak=!1,n}var e=a.prototype;return e.isAdState=function(){return!0},e.onPlaying=function(){var n=d.getState("ContentPlayback");this.contentResuming&&this.transitionTo(n)},e.onContentResumed=function(){var n=d.getState("ContentPlayback");this.contentResuming&&this.transitionTo(n)},e.isWaitingForAdBreak=function(){return this.waitingForAdBreak},e.isContentResuming=function(){return this.contentResuming},e.inAdBreak=function(){return this.player.ads._inLinearAdMode===!0},a}(b);d.registerState("AdState",K);var Q=function(t){v(a,t);function a(){return t.apply(this,arguments)||this}var e=a.prototype;return e.isAdState=function(){return!1},e.onContentChanged=function(n){var r=d.getState("BeforePreroll"),s=d.getState("Preroll");n.ads.debug("Received contentchanged event (ContentState)"),n.paused()?this.transitionTo(r):(this.transitionTo(s,!1),n.pause(),n.ads._pausedOnContentupdate=!0)},a}(b);d.registerState("ContentState",Q);var X=d.getState("ContentState"),Z=function(t){v(a,t);function a(){return t.apply(this,arguments)||this}a._getName=function(){return"AdsDone"};var e=a.prototype;return e.init=function(n){n.ads._contentHasEnded=!0,n.trigger("ended")},e.startLinearAdMode=function(){i.log.warn("Unexpected startLinearAdMode invocation (AdsDone)")},a}(X);d.registerState("AdsDone",Z);var R;function j(t){var a;i.browser.IS_IOS&&t.ads.isLive(t)&&t.seekable().length>0?a=t.currentTime()-t.seekable().end(0):a=t.currentTime();var e=t.$(".vjs-tech"),o=t.textTracks?t.textTracks():[],n=[],r={ended:t.ended(),currentSrc:t.currentSrc(),sources:t.currentSources(),src:t.tech_.src(),currentTime:a,type:t.currentType()};e&&(r.style=e.getAttribute("style"));for(var s=0;s<o.length;s++){var u=o[s];n.push({track:u,mode:u.mode}),u.mode="disabled"}return r.suppressedTracks=n,r}function ee(t,a){var e=t.ads.snapshot;if(a===void 0&&(a=function(){}),t.ads.disableNextSnapshotRestore===!0){t.ads.disableNextSnapshotRestore=!1,delete t.ads.snapshot,a();return}var o=t.$(".vjs-tech"),n=20,r=e.suppressedTracks,s,u=function(){for(var h=0;h<r.length;h++)s=r[h],s.track.mode=s.mode},l=function(){var h;if(i.browser.IS_IOS&&t.ads.isLive(t)){if(e.currentTime<0&&(t.seekable().length>0?h=t.seekable().end(0)+e.currentTime:h=t.currentTime(),t.currentTime(h)),t.paused()){var p=t.play();p&&p.catch&&p.catch(function(M){i.log.warn("Play promise rejected in IOS snapshot resume",M)})}}else if(e.ended)t.currentTime(t.duration());else{t.currentTime(e.currentTime);var k=t.play();k&&k.catch&&k.catch(function(M){i.log.warn("Play promise rejected in snapshot resume",M)})}t.ads.shouldRemoveAutoplay_&&(t.autoplay(!1),t.ads.shouldRemoveAutoplay_=!1)},c=function A(){if(t.off("contentcanplay",A),R&&t.clearTimeout(R),o=t.el().querySelector(".vjs-tech"),o.readyState>1||o.seekable===void 0||o.seekable.length>0)return l();if(n--)t.setTimeout(A,50);else try{l()}catch(h){i.log.warn("Failed to resume the content after an advertisement",h)}};if("style"in e&&o.setAttribute("style",e.style||""),t.ads.videoElementRecycled())t.one("resumeended",function(){delete t.ads.snapshot,a()}),t.one("contentloadedmetadata",u),i.browser.IS_IOS&&!t.autoplay()&&(t.autoplay(!0),t.ads.shouldRemoveAutoplay_=!0),t.src(e.sources),t.one("contentcanplay",c),R=t.setTimeout(c,2e3);else{if(u(),!t.ended()){var f=t.play();f&&f.catch&&f.catch(function(A){i.log.warn("Play promise rejected in snapshot restore",A)})}delete t.ads.snapshot,a()}}function te(t){t.ads.debug("Starting ad break"),t.ads._inLinearAdMode=!0,t.trigger("adstart"),t.ads.shouldTakeSnapshots()&&(t.ads.snapshot=j(t)),t.ads.shouldPlayContentBehindAd(t)&&(t.ads.preAdVolume_=t.volume(),t.volume(0)),t.addClass("vjs-ad-playing"),t.hasClass("vjs-live")&&t.removeClass("vjs-live"),t.ads.removeNativePoster()}function ne(t,a){t.ads.debug("Ending ad break"),a===void 0&&(a=function(){}),t.ads.adType=null,t.ads._inLinearAdMode=!1,t.trigger("adend"),t.removeClass("vjs-ad-playing"),t.ads.isLive(t)&&t.addClass("vjs-live"),t.ads.shouldTakeSnapshots()?ee(t,a):(t.volume(t.ads.preAdVolume_),a())}var S={start:te,end:ne},ae=d.getState("AdState"),oe=function(t){v(a,t);function a(){return t.apply(this,arguments)||this}a._getName=function(){return"Preroll"};var e=a.prototype;return e.init=function(n,r,s){if(this.waitingForAdBreak=!0,n.addClass("vjs-ad-loading"),s||n.ads.nopreroll_)return this.resumeAfterNoPreroll(n);var u=n.ads.settings.timeout;typeof n.ads.settings.prerollTimeout=="number"&&(u=n.ads.settings.prerollTimeout),this._timeout=n.setTimeout(function(){n.trigger("adtimeout")},u),r?this.handleAdsReady():this.adsReady=!1},e.onAdsReady=function(n){n.ads.inAdBreak()?i.log.warn("Unexpected adsready event (Preroll)"):(n.ads.debug("Received adsready event (Preroll)"),this.handleAdsReady())},e.handleAdsReady=function(){this.adsReady=!0,this.readyForPreroll()},e.afterLoadStart=function(n){var r=this.player;r.ads._hasThereBeenALoadStartDuringPlayerLife?n():(r.ads.debug("Waiting for loadstart..."),r.one("loadstart",function(){r.ads.debug("Received loadstart event"),n()}))},e.noPreroll=function(){var n=this;this.afterLoadStart(function(){n.player.ads.debug("Skipping prerolls due to nopreroll event (Preroll)"),n.resumeAfterNoPreroll(n.player)})},e.readyForPreroll=function(){var n=this.player;this.afterLoadStart(function(){n.ads.debug("Triggered readyforpreroll event (Preroll)"),n.trigger("readyforpreroll")})},e.onAdsCanceled=function(n){var r=this;n.ads.debug("adscanceled (Preroll)"),this.afterLoadStart(function(){r.resumeAfterNoPreroll(n)})},e.onAdsError=function(n){var r=this;i.log("adserror (Preroll)"),this.inAdBreak()?n.ads.endLinearAdMode():this.afterLoadStart(function(){r.resumeAfterNoPreroll(n)})},e.startLinearAdMode=function(){var n=this.player;this.adsReady&&!n.ads.inAdBreak()&&!this.isContentResuming()?(this.clearTimeout(n),n.ads.adType="preroll",this.waitingForAdBreak=!1,S.start(n),n.ads._shouldBlockPlay=!1):i.log.warn("Unexpected startLinearAdMode invocation (Preroll)")},e.onAdStarted=function(n){n.removeClass("vjs-ad-loading")},e.endLinearAdMode=function(){var n=this.player;this.inAdBreak()&&(n.removeClass("vjs-ad-loading"),n.addClass("vjs-ad-content-resuming"),this.contentResuming=!0,S.end(n))},e.skipLinearAdMode=function(){var n=this,r=this.player;r.ads.inAdBreak()||this.isContentResuming()?i.log.warn("Unexpected skipLinearAdMode invocation"):this.afterLoadStart(function(){r.trigger("adskip"),r.ads.debug("skipLinearAdMode (Preroll)"),n.resumeAfterNoPreroll(r)})},e.onAdTimeout=function(n){var r=this;this.afterLoadStart(function(){n.ads.debug("adtimeout (Preroll)"),r.resumeAfterNoPreroll(n)})},e.onNoPreroll=function(n){n.ads.inAdBreak()||this.isContentResuming()?i.log.warn("Unexpected nopreroll event (Preroll)"):this.noPreroll()},e.resumeAfterNoPreroll=function(n){if(this.contentResuming=!0,n.ads._shouldBlockPlay=!1,this.cleanupPartial(n),n.paused()&&(n.ads._playRequested||n.ads._pausedOnContentupdate)){var r=n.play();r&&r.then&&r.then(null,function(s){})}},e.cleanup=function(n){n.ads._hasThereBeenALoadStartDuringPlayerLife||i.log.warn("Leaving Preroll state before loadstart event can cause issues."),this.cleanupPartial(n)},e.cleanupPartial=function(n){n.removeClass("vjs-ad-loading"),n.removeClass("vjs-ad-content-resuming"),this.clearTimeout(n)},e.clearTimeout=function(n){n.clearTimeout(this._timeout),this._timeout=null},a}(ae);d.registerState("Preroll",oe);var re=d.getState("ContentState"),ie=function(t){v(a,t);function a(){return t.apply(this,arguments)||this}a._getName=function(){return"BeforePreroll"};var e=a.prototype;return e.init=function(n){this.adsReady=!1,this.shouldResumeToContent=!1,n.ads._shouldBlockPlay=!0},e.onAdsReady=function(n){n.ads.debug("Received adsready event (BeforePreroll)"),this.adsReady=!0},e.onPlay=function(n){var r=d.getState("Preroll");n.ads.debug("Received play event (BeforePreroll)"),this.transitionTo(r,this.adsReady,this.shouldResumeToContent)},e.onAdsCanceled=function(n){n.ads.debug("adscanceled (BeforePreroll)"),this.shouldResumeToContent=!0},e.onAdsError=function(){this.player.ads.debug("adserror (BeforePreroll)"),this.shouldResumeToContent=!0},e.onNoPreroll=function(){this.player.ads.debug("Skipping prerolls due to nopreroll event (BeforePreroll)"),this.shouldResumeToContent=!0},e.skipLinearAdMode=function(){var n=this.player;n.trigger("adskip"),n.ads.debug("skipLinearAdMode (BeforePreroll)"),this.shouldResumeToContent=!0},e.onContentChanged=function(){this.init(this.player)},a}(re);d.registerState("BeforePreroll",ie);var se=d.getState("AdState"),de=function(t){v(a,t);function a(){return t.apply(this,arguments)||this}a._getName=function(){return"Midroll"};var e=a.prototype;return e.init=function(n){n.ads.adType="midroll",S.start(n),n.addClass("vjs-ad-loading")},e.onAdStarted=function(n){n.removeClass("vjs-ad-loading")},e.endLinearAdMode=function(){var n=this.player;this.inAdBreak()&&(this.contentResuming=!0,n.addClass("vjs-ad-content-resuming"),n.removeClass("vjs-ad-loading"),S.end(n))},e.onAdsError=function(n){this.inAdBreak()&&n.ads.endLinearAdMode()},e.cleanup=function(n){n.removeClass("vjs-ad-loading"),n.removeClass("vjs-ad-content-resuming")},a}(se);d.registerState("Midroll",de);var ue=d.getState("AdState"),le=function(t){v(a,t);function a(){return t.apply(this,arguments)||this}a._getName=function(){return"Postroll"};var e=a.prototype;return e.init=function(n){if(this.waitingForAdBreak=!0,n.ads._contentEnding=!0,n.ads.nopostroll_){this.resumeContent(n);var s=d.getState("AdsDone");this.transitionTo(s)}else{n.addClass("vjs-ad-loading");var r=n.ads.settings.timeout;typeof n.ads.settings.postrollTimeout=="number"&&(r=n.ads.settings.postrollTimeout),this._postrollTimeout=n.setTimeout(function(){n.trigger("adtimeout")},r)}},e.startLinearAdMode=function(){var n=this.player;!n.ads.inAdBreak()&&!this.isContentResuming()?(n.ads.adType="postroll",n.clearTimeout(this._postrollTimeout),this.waitingForAdBreak=!1,S.start(n)):i.log.warn("Unexpected startLinearAdMode invocation (Postroll)")},e.onAdStarted=function(n){n.removeClass("vjs-ad-loading")},e.endLinearAdMode=function(){var n=this,r=this.player,s=d.getState("AdsDone");this.inAdBreak()&&(r.removeClass("vjs-ad-loading"),this.resumeContent(r),S.end(r,function(){n.transitionTo(s)}))},e.skipLinearAdMode=function(){var n=this.player;n.ads.inAdBreak()||this.isContentResuming()?i.log.warn("Unexpected skipLinearAdMode invocation"):(n.ads.debug("Postroll abort (skipLinearAdMode)"),n.trigger("adskip"),this.abort(n))},e.onAdTimeout=function(n){n.ads.debug("Postroll abort (adtimeout)"),this.abort(n)},e.onAdsError=function(n){n.ads.debug("Postroll abort (adserror)"),n.ads.inAdBreak()?n.ads.endLinearAdMode():this.abort(n)},e.onContentChanged=function(n){if(this.isContentResuming()){var r=d.getState("BeforePreroll");this.transitionTo(r)}else if(!this.inAdBreak()){var s=d.getState("Preroll");this.transitionTo(s)}},e.onNoPostroll=function(n){!this.isContentResuming()&&!this.inAdBreak()?this.abort(n):i.log.warn("Unexpected nopostroll event (Postroll)")},e.resumeContent=function(n){this.contentResuming=!0,n.addClass("vjs-ad-content-resuming")},e.abort=function(n){var r=d.getState("AdsDone");this.resumeContent(n),n.removeClass("vjs-ad-loading"),this.transitionTo(r)},e.cleanup=function(n){n.removeClass("vjs-ad-content-resuming"),n.clearTimeout(this._postrollTimeout),n.ads._contentEnding=!1},a}(ue);d.registerState("Postroll",le);var ce=d.getState("ContentState"),fe=function(t){v(a,t);function a(){return t.apply(this,arguments)||this}a._getName=function(){return"ContentPlayback"};var e=a.prototype;return e.init=function(n){n.ads._shouldBlockPlay=!1},e.onAdsReady=function(n){n.ads.debug("Received adsready event (ContentPlayback)"),n.ads.nopreroll_||(n.ads.debug("Triggered readyforpreroll event (ContentPlayback)"),n.trigger("readyforpreroll"))},e.onReadyForPostroll=function(n){var r=d.getState("Postroll");n.ads.debug("Received readyforpostroll event"),this.transitionTo(r)},e.startLinearAdMode=function(){var n=d.getState("Midroll");this.transitionTo(n)},a}(ce);d.registerState("ContentPlayback",fe);var he=d.getState("ContentState"),ge=function(t){v(a,t);function a(){return t.apply(this,arguments)||this}a._getName=function(){return"StitchedContentPlayback"};var e=a.prototype;return e.init=function(){this.player.ads._shouldBlockPlay=!1},e.onContentChanged=function(){this.player.ads.debug("Received contentchanged event ("+this.constructor._getName()+")")},e.startLinearAdMode=function(){var n=d.getState("StitchedAdRoll");this.transitionTo(n)},a}(he);d.registerState("StitchedContentPlayback",ge);var Ae=d.getState("AdState"),me=function(t){v(a,t);function a(){return t.apply(this,arguments)||this}a._getName=function(){return"StitchedAdRoll"};var e=a.prototype;return e.init=function(){this.waitingForAdBreak=!1,this.contentResuming=!1,this.player.ads.adType="stitched",S.start(this.player)},e.onPlaying=function(){},e.onContentResumed=function(){},e.onAdEnded=function(){this.endLinearAdMode(),this.player.trigger("ended")},e.endLinearAdMode=function(){var n=d.getState("StitchedContentPlayback");S.end(this.player),this.transitionTo(n)},a}(Ae);d.registerState("StitchedAdRoll",me);var ve=T.isMiddlewareMediatorSupported,pe=i.getTech("Html5").Events,Se={timeout:5e3,prerollTimeout:void 0,postrollTimeout:void 0,debug:!1,stitchedAds:!1,contentIsLive:void 0,liveCuePoints:!0},L=function(a){var e=this,o=i.mergeOptions(Se,a),n=[];pe.concat(["firstplay","loadedalldata"]).forEach(function(u){n.indexOf(u)===-1&&n.push(u)}),e.on(n,F),ve()||W(e,o.debug),e.setTimeout(function(){!e.ads._hasThereBeenALoadStartDuringPlayerLife&&e.src()!==""&&i.log.error("videojs-contrib-ads has not seen a loadstart event 5 seconds after being initialized, but a source is present. This indicates that videojs-contrib-ads was initialized too late. It must be initialized immediately after video.js in the same tick. As a result, some ads will not play and some media events will be incorrect. For more information, see http://videojs.github.io/videojs-contrib-ads/integrator/getting-started.html")},5e3),e.on("ended",function(){e.hasClass("vjs-has-started")||e.addClass("vjs-has-started")}),e.on("contenttimeupdate",function(){e.removeClass("vjs-waiting")}),e.on(["addurationchange","adcanplay"],function(){if(!e.ads.settings.stitchedAds&&!e.hasStarted()&&!(e.ads.snapshot&&e.currentSrc()===e.ads.snapshot.currentSrc)&&e.ads.inAdBreak()){var u=e.play();u&&u.catch&&u.catch(function(l){i.log.warn("Play promise rejected when playing ad",l)})}}),e.on("nopreroll",function(){e.ads.debug("Received nopreroll event"),e.ads.nopreroll_=!0}),e.on("nopostroll",function(){e.ads.debug("Received nopostroll event"),e.ads.nopostroll_=!0}),e.on("playing",function(){e.ads._cancelledPlay=!1,e.ads._pausedOnContentupdate=!1}),e.on("play",function(){e.ads._playRequested=!0}),e.one("loadstart",function(){e.ads._hasThereBeenALoadStartDuringPlayerLife=!0}),e.on("loadeddata",function(){e.ads._hasThereBeenALoadedData=!0}),e.on("loadedmetadata",function(){e.ads._hasThereBeenALoadedMetaData=!0}),e.ads=N(e),e.ads.settings=o,o.stitchedAds=!!o.stitchedAds,o.stitchedAds?e.ads._state=new(d.getState("StitchedContentPlayback"))(e):e.ads._state=new(d.getState("BeforePreroll"))(e),e.ads._state.init(e),e.ads.cueTextTracks=P,e.ads.adMacroReplacement=$.bind(e),U(e),e.on("contentchanged",e.ads.reset);var r=function(){return!e.ads.shouldPlayContentBehindAd(e)&&e.ads.inAdBreak()&&e.tech_.featuresNativeTextTracks&&i.browser.IS_IOS&&!Array.isArray(e.textTracks())},s=function(){var l=e.textTracks();if(r())for(var c=0;c<l.length;c++){var f=l[c];f.mode==="showing"&&(f.mode="disabled")}};e.ready(function(){e.textTracks().addEventListener("change",s)}),e.on(["play","playing","ended","adsready","adscanceled","adskip","adserror","adtimeout","adended","ads-ad-started","contentchanged","dispose","contentresumed","readyforpostroll","nopreroll","nopostroll"],function(u){e.ads._state.handleEvent(u.type)}),e.on("dispose",function(){e.ads.reset(),e.textTracks().removeEventListener("change",s)})};return L.VERSION=B,J(L),L});
//# sourceMappingURL=videojs.ads.6.6.5.7fd626ae17d0cbd9ad6b8be7bf2a8b7c.js.map
